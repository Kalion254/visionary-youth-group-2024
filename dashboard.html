<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Dashboard</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
    authDomain: "visionary-youth-grou-2024.firebaseapp.com",
    databaseURL: "https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
    projectId: "visionary-youth-grou-2024",
    storageBucket: "visionary-youth-grou-2024.firebasestorage.app",
    messagingSenderId: "372978592717",
    appId: "1:372978592717:web:624596619d41aab84f3284",
    measurementId: "G-FEHC1GM3B7"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUserUid;

  // Check login state
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUserUid = user.uid;
      loadUserData(user.uid);
    } else {
      alert("Please login first!");
      window.location.href = "index.html";
    }
  });

  // Load user data
  function loadUserData(uid) {
    const userRef = db.ref(`users/${uid}`);
    userRef.on('value', snapshot => {
      const data = snapshot.val();
      if (data) {
        document.getElementById("userName").innerText = data.name;
        document.getElementById("emailDisplay").innerText = data.email;
        document.getElementById("weeklySavings").innerText = data.financials.weekly_savings;
        document.getElementById("monthlySavings").innerText = data.financials.monthly_savings;
        document.getElementById("shares").innerText = data.financials.shares;
        document.getElementById("loan").innerText = data.financials.loan;

        // Populate profile form
        document.getElementById("profileName").value = data.name;
        document.getElementById("profileEmail").value = data.email;
      }
    });
  }

  // Logout
  function logout() {
    auth.signOut().then(() => {
      alert("Logged out successfully!");
      window.location.href = "index.html";
    });
  }

  // Update profile
  function updateProfile() {
    const name = document.getElementById("profileName").value;
    const email = document.getElementById("profileEmail").value;
    db.ref(`users/${currentUserUid}/name`).set(name);
    db.ref(`users/${currentUserUid}/email`).set(email);
    alert("Profile updated successfully!");
    loadUserData(currentUserUid);
  }

  // Apply loan
  function applyLoan() {
    const amount = prompt("Enter loan amount:");
    if (!amount || isNaN(amount)) return alert("Invalid amount");
    db.ref(`users/${currentUserUid}/loan_applications`).push({
      amount: parseFloat(amount),
      status: "Pending",
      timestamp: Date.now()
    });
    alert("Loan application submitted!");
  }

  // Download account statement
  function downloadStatement() {
    db.ref(`users/${currentUserUid}/financials`).once('value').then(snapshot => {
      const data = snapshot.val();
      const csv = `Type,Amount\nWeekly Savings,${data.weekly_savings}\nMonthly Savings,${data.monthly_savings}\nShares,${data.shares}\nLoan,${data.loan}`;
      const blob = new Blob([csv], {type: 'text/csv'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'account_statement.csv';
      link.click();
    });
  }
</script>

<style>
  body { font-family: Arial; background: #f0f4f8; margin: 0; }
  .header { background: #1976d2; color: white; padding: 20px; text-align: center; }
  .container { display: flex; flex-wrap: wrap; margin: 20px; gap: 20px; }
  .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); flex: 1 1 250px; }
  h2, h3 { margin: 0 0 10px 0; }
  button { padding: 10px 20px; border: none; border-radius: 6px; background: #1976d2; color: white; cursor: pointer; margin-top: 10px; }
  button:hover { background: #115293; }
  input { width: 100%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; }
</style>
</head>
<body>

<div class="header">
  <h1>Welcome, <span id="userName">User</span></h1>
  <p>Email: <span id="emailDisplay">email@example.com</span></p>
  <button onclick="logout()">Logout</button>
</div>

<div class="container">
  <div class="card">
    <h3>Weekly Savings</h3>
    <p id="weeklySavings">0</p>
  </div>
  <div class="card">
    <h3>Monthly Savings</h3>
    <p id="monthlySavings">0</p>
  </div>
  <div class="card">
    <h3>Shares</h3>
    <p id="shares">0</p>
  </div>
  <div class="card">
    <h3>Loan</h3>
    <p id="loan">0</p>
    <button onclick="applyLoan()">Apply Loan</button>
  </div>
  <div class="card">
    <h3>Profile Update</h3>
    <input type="text" id="profileName" placeholder="Full Name">
    <input type="email" id="profileEmail" placeholder="Email">
    <button onclick="updateProfile()">Update Profile</button>
  </div>
  <div class="card">
    <h3>Account Statement</h3>
    <button onclick="downloadStatement()">Download CSV</button>
  </div>
</div>

</body>
</html>
