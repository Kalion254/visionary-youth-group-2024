<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visionary Youth Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);}
header{background:#1e3c72;color:white;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 20px rgba(0,0,0,0.2);}
header h1{margin:0;font-size:22px;}
header .user-email{font-size:14px;opacity:0.8;}
header button{background:#ff5252;color:white;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;transition:0.3s;}
header button:hover{background:#ff1744;}
nav{display:flex;gap:10px;margin:15px 20px;}
nav button{flex:1;padding:12px;border:none;border-radius:10px;background:#bbdefb;color:#0d47a1;font-weight:bold;cursor:pointer;transition:0.3s;box-shadow:0 2px 5px rgba(0,0,0,0.15);}
nav button.active{background:#0d47a1;color:white;box-shadow:0 4px 10px rgba(0,0,0,0.25);}
.container{padding:20px;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:25px;}
.card{background:linear-gradient(135deg,#42a5f5,#1e88e5);color:white;padding:20px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.2);position:relative;transition:0.3s;}
.card h3{margin-top:0;font-size:18px;display:flex;align-items:center;}
.card h3 i{margin-right:8px;}
.progress-bar{height:20px;background:rgba(255,255,255,0.2);border-radius:12px;overflow:hidden;margin-top:8px;}
.progress{height:100%;border-radius:12px;text-align:right;color:white;padding-right:6px;transition:width 1s ease;}
.section{display:none;background:white;padding:25px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.15);}
.section.active{display:block;}
button{cursor:pointer;padding:10px 12px;border-radius:6px;border:none;background:#1e3c72;color:white;font-weight:bold;transition:0.3s;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
button:hover{background:#0d47a1;}
form input,form select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;font-size:15px;}
#loanTimeline div{padding:10px;margin-bottom:8px;border-left:4px solid #1e3c72;transition:all 0.4s ease;}
#loanProgressFill{height:15px;background:#42a5f5;width:0%;border-radius:8px;margin-bottom:15px;}
/* Debug box */
#debugBox{background:#f0f0f0;color:#333;padding:10px;border-radius:10px;margin-top:20px;white-space:pre-wrap;font-size:13px;max-height:200px;overflow:auto;}
</style>
</head>
<body>
<header>
<div>
<h1>Visionary Youth Dashboard</h1>
<div class="user-email" id="emailDisplay">email@example.com</div>
</div>
<button id="logoutBtn">Logout</button>
</header>

<nav>
<button class="tab-btn active" data-target="financial">Financial Overview</button>
<button class="tab-btn" data-target="profile">Profile</button>
<button class="tab-btn" data-target="loan">Loan Application</button>
<button class="tab-btn" data-target="loanProgress">Loan Progress</button>
<button class="tab-btn" data-target="statement">Account Statement</button>
</nav>

<div class="container">

<!-- Financial Overview -->
<div id="financial" class="section active">
<div class="card-grid">
<div class="card">
<h3><i class="fa-solid fa-money-bill-wave"></i> Weekly Savings</h3>
<p id="weeklySavings">0</p>
<div class="progress-bar"><div class="progress" id="weeklyProgress">0%</div></div>
</div>
<div class="card">
<h3><i class="fa-solid fa-calendar-days"></i> Monthly Savings</h3>
<p id="monthlySavings">0</p>
<div class="progress-bar"><div class="progress" id="monthlyProgress">0%</div></div>
</div>
<div class="card">
<h3><i class="fa-solid fa-chart-simple"></i> Shares</h3>
<p id="shares">0</p>
<div class="progress-bar"><div class="progress" id="sharesProgress">0%</div></div>
</div>
<div class="card">
<h3><i class="fa-solid fa-hand-holding-dollar"></i> Loan</h3>
<p id="loan">0</p>
<div class="progress-bar"><div class="progress" id="loanProgress">0%</div></div>
</div>
<div class="card">
<h3><i class="fa-solid fa-circle-exclamation"></i> Unpaid Balances</h3>
<p id="unpaidBalances">0</p>
</div>
<div class="card">
<h3><i class="fa-solid fa-gem"></i> Dividends</h3>
<p id="dividends">0</p>
</div>
</div>

<!-- Debug box -->
<h3>üîé Live Financial Data (Debug)</h3>
<pre id="debugBox">Loading...</pre>
</div>

<!-- Profile -->
<div id="profile" class="section">
<h2>Update Profile</h2>
<form id="profileForm">
<label>Name</label><input id="profileName" required>
<label>ID</label><input id="profileID" required>
<label>Email</label><input type="email" id="profileEmail" required>
<label>Phone</label><input id="profilePhone" required>
<label>Origin</label><input id="profileOrigin" required>
<label>Member Number</label><input id="profileMember" required>
<label>Passport Upload</label><input type="file" id="passport" accept="image/*" required>
<button type="submit">Update Profile</button>
</form>
</div>

<!-- Loan Application -->
<div id="loan" class="section">
<h2>Loan Application</h2>
<div class="progress-bar"><div id="loanProgressFill"></div></div>
<!-- Loan steps here (unchanged) -->
</div>

<!-- Loan Progress -->
<div id="loanProgress" class="section">
<h2>Loan Progress Timeline</h2>
<div id="loanTimeline"></div>
</div>

<!-- Account Statement -->
<div id="statement" class="section">
<h2>Download Account Statement</h2>
<button id="downloadStatementBtn">Download CSV</button>
</div>

</div>

<script>
// Firebase config
const firebaseConfig={
apiKey:"AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
authDomain:"visionary-youth-grou-2024.firebaseapp.com",
databaseURL:"https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
projectId:"visionary-youth-grou-2024",
storageBucket:"visionary-youth-grou-2024.firebasestorage.app",
messagingSenderId:"372978592717",
appId:"1:372978592717:web:624596619d41aab84f3284",
measurementId:"G-FEHC1GM3B7"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();
let currentUserUid;

// Auth check
auth.onAuthStateChanged(user=>{
 if(user){
   currentUserUid=user.uid;
   document.getElementById("emailDisplay").textContent=user.email;
   loadFinancials();
 }else{window.location.href="index.html";}
});

// Load financials
function loadFinancials(){
 db.ref(`users/${currentUserUid}/financials`).on("value",snap=>{
   const data=snap.val();
   if(!data){
     document.getElementById("debugBox").textContent="‚ö†Ô∏è No financial data found for this user.";
     return;
   }
   // Update DOM
   document.getElementById("weeklySavings").textContent=data.weekly_savings||0;
   document.getElementById("monthlySavings").textContent=data.monthly_savings||0;
   document.getElementById("shares").textContent=data.shares||0;
   document.getElementById("loan").textContent=data.loan||0;
   document.getElementById("unpaidBalances").textContent=data.unpaid_balances||0;
   document.getElementById("dividends").textContent=data.dividends||0;
   document.getElementById("weeklyProgress").style.width=((data.weekly_savings||0)/5000*100)+"%";
   document.getElementById("monthlyProgress").style.width=((data.monthly_savings||0)/5000*100)+"%";
   document.getElementById("sharesProgress").style.width=((data.shares||0)/1000*100)+"%";
   document.getElementById("loanProgress").style.width=((data.loan||0)/10000*100)+"%";

   // Show raw JSON in debug box
   document.getElementById("debugBox").textContent = JSON.stringify(data,null,2);
 },error=>{
   document.getElementById("debugBox").textContent="‚ùå Error: "+error.message;
 });
}
</script>
</body>
</html>
