<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visionary Youth Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
  margin:0; font-family:"Poppins",sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff; display:flex; min-height:100vh;
}
.sidebar {
  width:220px; background:rgba(0,0,0,0.4);
  display:flex; flex-direction:column; padding:20px; box-shadow:2px 0 10px rgba(0,0,0,0.5);
}
.sidebar h2 { color:#ffeb3b; margin-bottom:20px; font-size:20px; }
.sidebar button {
  background:none; border:none; color:white; padding:12px; text-align:left;
  border-radius:8px; display:flex; align-items:center; gap:8px;
  cursor:pointer; transition:0.3s;
}
.sidebar button:hover, .sidebar button.active { background:#1565c0; }
.main { flex:1; display:flex; flex-direction:column; }
header {
  background:rgba(21,101,192,0.9); padding:15px;
  display:flex; justify-content:space-between; align-items:center;
}
.container { flex:1; padding:20px; overflow-y:auto; }
.section { display:none; background:rgba(255,255,255,0.08); padding:20px; border-radius:12px; }
.section.active { display:block; animation:fadeIn .4s ease; }
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.mini-tabs { display:flex; gap:8px; margin-bottom:10px; }
.mini-btn { flex:1; padding:8px; border:none; border-radius:8px; background:rgba(255,255,255,0.2); color:white; cursor:pointer; }
.mini-btn.active { background:#2196f3; }
.progress-bar { background:rgba(255,255,255,0.2); border-radius:20px; overflow:hidden; margin:5px 0; height:20px; }
.progress-fill { background:#ffeb3b; height:100%; width:0; transition:width 1s; }
form input, form select { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:none; }
form button { background:#1565c0; color:white; padding:10px; border:none; border-radius:8px; cursor:pointer; }
form button:hover { background:#0d47a1; }
footer { background:rgba(0,0,0,0.4); padding:10px; text-align:center; font-size:13px; }
.toast {
  position:fixed; bottom:20px; right:20px;
  background:#333; color:#fff; padding:10px 20px; border-radius:6px;
  opacity:0; transform:translateY(20px); transition:0.3s;
}
.toast.show { opacity:1; transform:translateY(0); }
</style>
</head>
<body>
<div class="sidebar">
  <h2>Menu</h2>
  <button class="tab-btn active" data-target="financial"><i class="fa-solid fa-chart-line"></i> Financial</button>
  <button class="tab-btn" data-target="profile"><i class="fa-solid fa-user"></i> Profile</button>
  <button class="tab-btn" data-target="loan"><i class="fa-solid fa-money-check-dollar"></i> Loan</button>
  <button class="tab-btn" data-target="loanProgress"><i class="fa-solid fa-clock"></i> Loan Progress</button>
  <button class="tab-btn" data-target="achievements"><i class="fa-solid fa-award"></i> Achievements</button>
  <button class="tab-btn" data-target="statement"><i class="fa-solid fa-file-invoice"></i> Statement</button>
  <button id="logoutBtn"><i class="fa-solid fa-sign-out-alt"></i> Logout</button>
</div>

<div class="main">
<header>
  <div id="emailDisplay"></div>
</header>
<div class="container">
  <!-- Financial -->
  <div id="financial" class="section active">
    <h2>Financial Overview</h2>
    <div class="mini-tabs">
      <button class="mini-btn active" data-mini="savings">Savings</button>
      <button class="mini-btn" data-mini="shares">Shares</button>
      <button class="mini-btn" data-mini="loans">Loans</button>
      <button class="mini-btn" data-mini="balances">Balances</button>
      <button class="mini-btn" data-mini="dividends">Dividends</button>
    </div>
    <div id="savings" class="mini-section active">
      <p>Weekly: <span id="weeklySavings">0</span></p><div class="progress-bar"><div id="weeklyBar" class="progress-fill"></div></div>
      <p>Monthly: <span id="monthlySavings">0</span></p><div class="progress-bar"><div id="monthlyBar" class="progress-fill"></div></div>
    </div>
    <div id="shares" class="mini-section"><p>Shares: <span id="sharesVal">0</span></p><div class="progress-bar"><div id="sharesBar" class="progress-fill"></div></div></div>
    <div id="loans" class="mini-section"><p>Loans: <span id="loanVal">0</span></p><div class="progress-bar"><div id="loanBar" class="progress-fill"></div></div></div>
    <div id="balances" class="mini-section"><p>Balances: <span id="balanceVal">0</span></p><div class="progress-bar"><div id="balanceBar" class="progress-fill"></div></div></div>
    <div id="dividends" class="mini-section"><p>Dividends: <span id="divVal">0</span></p><div class="progress-bar"><div id="divBar" class="progress-fill"></div></div></div>
  </div>

  <!-- Profile -->
  <div id="profile" class="section">
    <h2>Profile Update</h2>
    <form id="profileForm">
      <input id="profileName" placeholder="Name" required>
      <input id="profileID" placeholder="ID" required>
      <input type="email" id="profileEmail" placeholder="Email" required>
      <input id="profilePhone" placeholder="Phone" required>
      <input id="profileOrigin" placeholder="Origin" required>
      <input id="profileMember" placeholder="Member Number" required>
      <input type="file" id="passport" accept="image/*" required>
      <button type="submit">Update Profile</button>
    </form>
  </div>

  <!-- Loan -->
  <div id="loan" class="section">
    <h2>Loan Application</h2>
    <form id="loanForm">
      <h3>Personal</h3>
      <input id="loanName" placeholder="Full Name" required>
      <input id="loanID" placeholder="ID Number" required>
      <input id="loanPhone" placeholder="Phone Number" required>
      <h3>Residence</h3>
      <input id="loanAddress" placeholder="Address" required>
      <input id="loanOrigin" placeholder="Origin" required>
      <h3>Guarantor</h3>
      <input id="guarantorName" placeholder="Guarantor Name" required>
      <input id="guarantorPhone" placeholder="Guarantor Phone" required>
      <h3>Loan Details</h3>
      <input id="loanAmount" placeholder="Amount" required>
      <select id="loanCategory" required>
        <option value="">Select Category</option>
        <option>Business</option><option>Education</option><option>Emergency</option>
      </select>
      <button type="submit">Apply</button>
    </form>
  </div>

  <!-- Loan Progress -->
  <div id="loanProgress" class="section"><h2>Loan Progress</h2><div id="loanTimeline"></div></div>

  <!-- Achievements -->
  <div id="achievements" class="section"><h2>Achievements</h2><div id="achievementList"></div></div>

  <!-- Statement -->
  <div id="statement" class="section"><h2>Statement</h2><button id="downloadStatementBtn">Download</button></div>
</div>
<footer>Â© 2025 Visionary Youth</footer>
</div>

<div id="toast" class="toast"></div>

<script>
const firebaseConfig={/* your firebase config */};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database(), storage=firebase.storage();
let currentUserUid;

/* Toast */
function showToast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),3000);}

/* Tabs */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.onclick=()=>{document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));document.getElementById(btn.dataset.target).classList.add("active");btn.classList.add("active");};
});
document.querySelectorAll(".mini-btn").forEach(btn=>{
  btn.onclick=()=>{document.querySelectorAll(".mini-section").forEach(s=>s.classList.remove("active"));document.querySelectorAll(".mini-btn").forEach(b=>b.classList.remove("active"));document.getElementById(btn.dataset.mini).classList.add("active");btn.classList.add("active");};
});

/* Logout */
document.getElementById("logoutBtn").onclick=()=>auth.signOut().then(()=>location.href="index.html");

/* Auth */
auth.onAuthStateChanged(user=>{
  if(user){currentUserUid=user.uid;emailDisplay.textContent="Welcome, "+user.email;loadFinancials();loadLoanProgress();loadAchievements();}
  else location.href="index.html";
});

/* Financials */
function animateBar(id,val,max=10000){document.getElementById(id).style.width=Math.min(val/max*100,100)+"%";}
function loadFinancials(){
  db.ref("users/"+currentUserUid+"/financials").on("value",s=>{
    const d=s.val()||{};
    weeklySavings.textContent=d.weekly_savings||0;monthlySavings.textContent=d.monthly_savings||0;
    sharesVal.textContent=d.shares||0;loanVal.textContent=d.loan||0;balanceVal.textContent=d.unpaid_balances||0;divVal.textContent=d.dividends||0;
    animateBar("weeklyBar",d.weekly_savings||0);animateBar("monthlyBar",d.monthly_savings||0);animateBar("sharesBar",d.shares||0);animateBar("loanBar",d.loan||0);animateBar("balanceBar",d.unpaid_balances||0);animateBar("divBar",d.dividends||0);
  });
}

/* Profile Update Once */
profileForm.onsubmit=async e=>{
  e.preventDefault();
  const ref=db.ref("users/"+currentUserUid+"/profile");
  const snap=await ref.get(); if(snap.exists()){showToast("Profile already updated!");return;}
  const file=passport.files[0];const url=file?await storage.ref("passports/"+currentUserUid).put(file).then(s=>s.ref.getDownloadURL()):"";
  await ref.set({name:profileName.value,id:profileID.value,email:profileEmail.value,phone:profilePhone.value,origin:profileOrigin.value,memberNumber:profileMember.value,passportURL:url});
  showToast("Profile saved!");
};

/* Loan Apply */
loanForm.onsubmit=async e=>{
  e.preventDefault();
  const data={personal:{name:loanName.value,id:loanID.value,phone:loanPhone.value},residence:{address:loanAddress.value,origin:loanOrigin.value},guarantor:{name:guarantorName.value,phone:guarantorPhone.value},loan:{amount:loanAmount.value,category:loanCategory.value},status:"Applied",timestamp:Date.now()};
  await db.ref("users/"+currentUserUid+"/loan_applications").push(data);
  showToast("Loan application submitted!");
};

/* Loan Progress */
function loadLoanProgress(){loanTimeline.innerHTML="";db.ref("users/"+currentUserUid+"/loan_applications").on("value",snap=>{loanTimeline.innerHTML="";snap.forEach(c=>{const loan=c.val();loanTimeline.innerHTML+=`<p>${loan.loan.amount} - ${loan.status}</p>`;});});}

/* Achievements */
function loadAchievements(){achievementList.innerHTML="";db.ref("users/"+currentUserUid+"/achievements").on("value",s=>{achievementList.innerHTML="";const d=s.val()||{};if(!Object.keys(d).length)achievementList.textContent="No achievements";for(let k in d){const a=d[k];achievementList.innerHTML+=`<div><h4>${a.title}</h4><p>${a.description}</p></div>`;}});}

/* Statement */
downloadStatementBtn.onclick=()=>{db.ref("users/"+currentUserUid+"/financials").once("value").then(s=>{let d=s.val()||{},csv="Field,Value\\n";for(let k in d)csv+=k+","+d[k]+"\\n";const blob=new Blob([csv],{type:"text/csv"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="statement.csv";link.click();});};

/* Auto logout 3min */
let logoutTimer;function resetTimer(){clearTimeout(logoutTimer);logoutTimer=setTimeout(()=>{showToast("Logged out for inactivity");auth.signOut().then(()=>location.href="index.html");},180000);}
["click","mousemove","keydown","scroll","touchstart"].forEach(e=>document.addEventListener(e,resetTimer));resetTimer();
</script>
</body>
</html>
