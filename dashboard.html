import React, { useEffect, useState, useRef } from "react";

/**
 * Visionary Youth Group — Single-file React portal
 * - Uses Tailwind CSS for styling (assumes Tailwind is configured)
 * - Uses Firebase v9 modular SDK (Realtime Database, Auth, Storage)
 * - Exposes: Dashboard (balances, points), Loan Wizard, Withdrawals, Profile,
 *   Account Statement (PDF download), Admin panel for approvals
 *
 * Install dependencies:
 * npm install firebase jspdf
 *
 * Notes:
 * - Replace the firebaseConfig object below with your Firebase credentials.
 * - This file is intentionally self-contained for easy pasting into your pages.
 */

// ---- FIREBASE SETUP ----
import { initializeApp } from "firebase/app";
import {
  getDatabase,
  ref,
  onValue,
  push,
  set,
  update,
  get,
  child,
} from "firebase/database";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword } from "firebase/auth";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "firebase/storage";
import jsPDF from "jspdf";

// <- REPLACE with your Firebase config (or paste your credentials into your app env) ->
const firebaseConfig = {
  apiKey: "REPLACE_API_KEY",
  authDomain: "REPLACE_AUTH_DOMAIN",
  databaseURL: "REPLACE_DATABASE_URL",
  projectId: "REPLACE_PROJECT_ID",
  storageBucket: "REPLACE_STORAGE_BUCKET",
  messagingSenderId: "REPLACE_MESSAGING_SENDER_ID",
  appId: "REPLACE_APP_ID",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const storage = getStorage(app);

// ---- Helpers ----
const formatCurrency = (v) => {
  if (v == null) return "Ksh 0";
  return `Ksh ${Number(v).toLocaleString()}`;
};

// Simple role check - in production store roles in DB and verify server-side
const isAdminUser = (userEmail) => {
  const admins = ["admin@visionary.local"]; // replace with real admin emails
  return admins.includes(userEmail);
};

// ---- Main Component ----
export default function VisionaryYouthPortal() {
  const [user, setUser] = useState(null);
  const [balances, setBalances] = useState({ monthly: 0, weekly: 0, totalLoans: 0, outstanding: 0, paid: 0 });
  const [points, setPoints] = useState(0);
  const [loans, setLoans] = useState([]);
  const [applications, setApplications] = useState([]);
  const [activeTab, setActiveTab] = useState("dashboard");
  const [profile, setProfile] = useState({ fullName: "", phone: "", memberNo: "", residence: "", education: "", parentName: "" });
  const [loginForm, setLoginForm] = useState({ email: "", password: "" });
  const fileInputRef = useRef(null);

  // --- Auth listener ---
  useEffect(() => {
    const unsub = onAuthStateChanged(auth, (u) => {
      if (u) {
        setUser(u);
        // award points for login
        awardPoints(u.uid, 1);
        subscribeUserData(u.uid);
        subscribeAdminData();
      } else {
        setUser(null);
      }
    });
    return () => unsub();
  }, []);

  // --- Subscriptions ---
  function subscribeUserData(uid) {
    // balances
    const bRef = ref(db, `balances/${uid}`);
    onValue(bRef, (snap) => {
      if (snap.exists()) setBalances(snap.val());
    });

    // points
    const pRef = ref(db, `points/${uid}`);
    onValue(pRef, (snap) => {
      setPoints(snap.exists() ? snap.val().score || 0 : 0);
    });

    // loans
    const loansRef = ref(db, `loans/${uid}`);
    onValue(loansRef, (snap) => {
      const arr = [];
      snap.forEach((child) => arr.push({ id: child.key, ...child.val() }));
      setLoans(arr);
    });

    // profile
    const profRef = ref(db, `profiles/${uid}`);
    onValue(profRef, (snap) => {
      if (snap.exists()) setProfile(snap.val());
    });
  }

  function subscribeAdminData() {
    // loan applications (admin view)
    const appsRef = ref(db, `loanApplications`);
    onValue(appsRef, (snap) => {
      const out = [];
      snap.forEach((c) => out.push({ id: c.key, ...c.val() }));
      setApplications(out);
    });
  }

  // --- Actions ---
  async function awardPoints(uid, n = 1) {
    const pRef = ref(db, `points/${uid}`);
    const snap = await get(pRef);
    const curr = snap.exists() ? (snap.val().score || 0) : 0;
    await set(pRef, { score: curr + n });
    setPoints(curr + n);
  }

  async function handleProfileSave() {
    if (!user) return;
    const pRef = ref(db, `profiles/${user.uid}`);
    await set(pRef, profile);
    alert("Profile updated");
  }

  async function handleLogin(e) {
    e.preventDefault();
    try {
      await signInWithEmailAndPassword(auth, loginForm.email, loginForm.password);
    } catch (err) {
      console.error(err);
      alert("Login failed: " + err.message);
    }
  }

  // --- Loan Application Wizard submission ---
  async function submitLoanApplication(data) {
    if (!user) return alert("Please sign in to apply");
    // push to loanApplications
    const applicationsRef = ref(db, `loanApplications`);
    const newAppRef = push(applicationsRef);
    await set(newAppRef, {
      applicantUid: user.uid,
      applicantEmail: user.email || null,
      applicantProfile: data.personal,
      residence: data.residence,
      education: data.education,
      parents: data.parents,
      amount: data.amount,
      bank: data.bank,
      accountNumber: data.accountNumber,
      status: "pending",
      createdAt: Date.now(),
    });
    alert("Application submitted — admin will review it.");
  }

  // --- Admin approves application ---
  async function adminApproveApplication(appId, approve = true) {
    const appRef = ref(db, `loanApplications/${appId}`);
    await update(appRef, {
      status: approve ? "approved" : "rejected",
      reviewedAt: Date.now(),
      reviewedBy: user ? user.email : "admin",
    });
    alert("Application " + (approve ? "approved" : "rejected"));
  }

  // --- Withdrawals ---
  async function submitWithdrawal(form) {
    if (!user) return alert("Please sign in to withdraw");
    if (!form.reason || form.reason.length < 200) return alert("Reason must be at least 200 characters.");
    const wRef = ref(db, `withdrawals`);
    const newW = push(wRef);
    await set(newW, {
      uid: user.uid,
      profile: profile,
      memberNo: profile.memberNo || "",
      amount: form.amount,
      reason: form.reason,
      status: "submitted",
      createdAt: Date.now(),
    });
    // generate PDF for member to download and take to office
    generateWithdrawalPDF({ ...form, profile });
    alert("Withdrawal submitted. A PDF has been downloaded for presentation at the office.");
  }

  function generateWithdrawalPDF({ amount, reason, profile }) {
    const doc = new jsPDF();
    doc.setFontSize(14);
    doc.text("Visionary Youth Group - Withdrawal Form", 20, 20);
    doc.setFontSize(11);
    doc.text(`Member: ${profile.fullName || ""}`, 20, 36);
    doc.text(`Member No: ${profile.memberNo || ""}`, 20, 44);
    doc.text(`Amount: Ksh ${amount}`, 20, 52);
    doc.text("Reason (min 200 chars):", 20, 68);
    const split = doc.splitTextToSize(reason, 170);
    doc.text(split, 20, 76);
    doc.text("\nOffice Use Only:\nApproved: _________\nStamp: ___________", 20, 160);
    doc.save(`withdrawal_${profile.memberNo || "guest"}.pdf`);
  }

  // --- File upload (ID) ---
  async function uploadIDFile(file) {
    if (!user) return alert("Please sign in to upload");
    if (!file) return;
    const storagePath = `ids/${user.uid}/${file.name}`;
    const sRef = storageRef(storage, storagePath);
    await uploadBytes(sRef, file);
    const url = await getDownloadURL(sRef);
    // save to profile
    const pRef = ref(db, `profiles/${user.uid}/idDoc`);
    await set(pRef, url);
    alert("ID uploaded successfully");
  }

  // --- Account statement: compile transactions from `transactions/{uid}` and create PDF ---
  async function downloadAccountStatement() {
    if (!user) return alert("Please sign in");
    const tRef = ref(db, `transactions/${user.uid}`);
    const snap = await get(tRef);
    const txns = [];
    if (snap.exists()) snap.forEach((c) => txns.push({ id: c.key, ...c.val() }));

    const doc = new jsPDF();
    doc.setFontSize(14);
    doc.text("Visionary Youth Group - Account Statement", 20, 20);
    doc.setFontSize(11);
    doc.text(`Member: ${profile.fullName || ""}`, 20, 30);
    doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 36);

    let y = 48;
    doc.setFontSize(10);
    doc.text("Date", 20, y);
    doc.text("Type", 60, y);
    doc.text("Amount", 120, y);
    doc.text("Notes", 150, y);
    y += 6;
    txns.forEach((t) => {
      if (y > 272) {
        doc.addPage();
        y = 20;
      }
      doc.text(new Date(t.date || t.createdAt || Date.now()).toLocaleDateString(), 20, y);
      doc.text(t.type || "-", 60, y);
      doc.text((t.amount || "0").toString(), 120, y);
      doc.text(t.note ? String(t.note).substring(0, 30) : "", 150, y);
      y += 6;
    });
    doc.save(`statement_${profile.memberNo || user.uid}.pdf`);
  }

  // --- UI Subcomponents ---
  function DashboardTab() {
    return (
      <div className="p-4 space-y-6">
        <h2 className="text-2xl font-semibold">Overview</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Monthly Saving</div>
            <div className="text-xl font-bold">{formatCurrency(balances.monthly)}</div>
          </div>
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Weekly Saving</div>
            <div className="text-xl font-bold">{formatCurrency(balances.weekly)}</div>
          </div>
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Points</div>
            <div className="text-xl font-bold">{points}</div>
          </div>
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Total Loans</div>
            <div className="text-xl font-bold">{formatCurrency(balances.totalLoans)}</div>
          </div>
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Outstanding</div>
            <div className="text-xl font-bold">{formatCurrency(balances.outstanding)}</div>
          </div>
          <div className="p-4 bg-white rounded-2xl shadow">
            <div className="text-sm">Paid Balances</div>
            <div className="text-xl font-bold">{formatCurrency(balances.paid)}</div>
          </div>
        </div>

        <div className="mt-6 bg-white p-4 rounded-2xl shadow">
          <h3 className="font-semibold mb-2">Loans</h3>
          <div className="space-y-2">
            {loans.length === 0 && <div className="text-sm text-gray-500">No loans yet.</div>}
            {loans.map((l) => (
              <div key={l.id} className="p-2 border rounded flex justify-between items-center">
                <div>
                  <div className="font-medium">{l.product || "Loan"} — {formatCurrency(l.amount)}</div>
                  <div className="text-xs text-gray-600">Status: {l.status}</div>
                </div>
                <div>
                  <button className="px-3 py-1 rounded bg-blue-600 text-white" onClick={() => setActiveTab("loanWizard")}>View / Apply</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // --- Loan Wizard multi-step ---
  function LoanWizard() {
    const [step, setStep] = useState(1);
    const [data, setData] = useState({ personal: {}, residence: {}, education: {}, parents: {}, amount: "", bank: "", accountNumber: "" });

    function updateStepData(part, obj) {
      setData((d) => ({ ...d, [part]: { ...(d[part] || {}), ...obj } }));
    }

    function canProceed() {
      if (step === 1) return !!(data.personal.fullName && data.personal.idNumber);
      if (step === 2) return !!data.residence.location;
      if (step === 3) return !!data.education.level;
      if (step === 4) return !!data.parents.parentName;
      if (step === 5) return data.amount && Number(data.amount) > 0 && data.bank && data.accountNumber;
      return true;
    }

    return (
      <div className="p-4">
        <h2 className="text-xl font-semibold mb-3">Loan Application Wizard</h2>
        <div className="bg-white p-4 rounded-2xl shadow space-y-4">
          <div className="flex space-x-2 items-center text-sm">
            <div className={`px-2 py-1 rounded ${step === 1 ? "bg-blue-600 text-white" : "bg-gray-100"}`}>1 Personal</div>
            <div className={`px-2 py-1 rounded ${step === 2 ? "bg-blue-600 text-white" : "bg-gray-100"}`}>2 Residence</div>
            <div className={`px-2 py-1 rounded ${step === 3 ? "bg-blue-600 text-white" : "bg-gray-100"}`}>3 Education</div>
            <div className={`px-2 py-1 rounded ${step === 4 ? "bg-blue-600 text-white" : "bg-gray-100"}`}>4 Parents</div>
            <div className={`px-2 py-1 rounded ${step === 5 ? "bg-blue-600 text-white" : "bg-gray-100"}`}>5 Application</div>
          </div>

          {step === 1 && (
            <div>
              <label className="block text-sm">Full name</label>
              <input className="w-full p-2 border rounded" value={data.personal.fullName || ""} onChange={(e) => updateStepData("personal", { fullName: e.target.value })} />
              <label className="block text-sm mt-2">ID Number</label>
              <input className="w-full p-2 border rounded" value={data.personal.idNumber || ""} onChange={(e) => updateStepData("personal", { idNumber: e.target.value })} />
              <label className="block text-sm mt-2">Upload ID</label>
              <input type="file" ref={fileInputRef} className="w-full" onChange={(e) => uploadIDFile(e.target.files[0])} />
            </div>
          )}

          {step === 2 && (
            <div>
              <label className="block text-sm">Residence</label>
              <input className="w-full p-2 border rounded" value={data.residence.location || ""} onChange={(e) => updateStepData("residence", { location: e.target.value })} />
              <label className="block text-sm mt-2">House/Plot No</label>
              <input className="w-full p-2 border rounded" value={data.residence.house || ""} onChange={(e) => updateStepData("residence", { house: e.target.value })} />
            </div>
          )}

          {step === 3 && (
            <div>
              <label className="block text-sm">Highest Education Level</label>
              <input className="w-full p-2 border rounded" value={data.education.level || ""} onChange={(e) => updateStepData("education", { level: e.target.value })} />
              <label className="block text-sm mt-2">Institution</label>
              <input className="w-full p-2 border rounded" value={data.education.institution || ""} onChange={(e) => updateStepData("education", { institution: e.target.value })} />
            </div>
          )}

          {step === 4 && (
            <div>
              <label className="block text-sm">Parent/Guardian Name</label>
              <input className="w-full p-2 border rounded" value={data.parents.parentName || ""} onChange={(e) => updateStepData("parents", { parentName: e.target.value })} />
              <label className="block text-sm mt-2">Parent Phone</label>
              <input className="w-full p-2 border rounded" value={data.parents.parentPhone || ""} onChange={(e) => updateStepData("parents", { parentPhone: e.target.value })} />
            </div>
          )}

          {step === 5 && (
            <div>
              <label className="block text-sm">Amount Applying For (Ksh)</label>
              <input type="number" className="w-full p-2 border rounded" value={data.amount} onChange={(e) => setData((d) => ({ ...d, amount: e.target.value }))} />
              <label className="block text-sm mt-2">Bank</label>
              <select className="w-full p-2 border rounded" value={data.bank} onChange={(e) => setData((d) => ({ ...d, bank: e.target.value }))}>
                <option value="">Select bank</option>
                <option value="KCB">KCB</option>
                <option value="Equity">Equity</option>
                <option value="NCBA">NCBA</option>
                <option value="Cooperative">Cooperative</option>
              </select>
              <label className="block text-sm mt-2">Account Number</label>
              <input className="w-full p-2 border rounded" value={data.accountNumber} onChange={(e) => setData((d) => ({ ...d, accountNumber: e.target.value }))} />
            </div>
          )}

          <div className="flex justify-between mt-4">
            <div>
              {step > 1 && <button className="px-3 py-1 border rounded" onClick={() => setStep((s) => s - 1)}>Back</button>}
            </div>
            <div>
              {step < 5 && <button disabled={!canProceed()} className={`px-3 py-1 rounded ${canProceed() ? "bg-blue-600 text-white" : "bg-gray-200"}`} onClick={() => setStep((s) => s + 1)}>Next</button>}
              {step === 5 && <button className="ml-2 px-3 py-1 rounded bg-green-600 text-white" onClick={() => submitLoanApplication(data)}>Submit Application</button>}
            </div>
          </div>
        </div>
      </div>
    );
  }

  function WithdrawalsTab() {
    const [form, setForm] = useState({ amount: "", reason: "" });
    return (
      <div className="p-4">
        <h2 className="text-xl font-semibold mb-3">Withdrawal Form</h2>
        <div className="bg-white p-4 rounded-2xl shadow space-y-3">
          <label>Member No</label>
          <input className="w-full p-2 border rounded" value={profile.memberNo || ""} readOnly />
          <label>Amount (Ksh)</label>
          <input className="w-full p-2 border rounded" value={form.amount} onChange={(e) => setForm({ ...form, amount: e.target.value })} />
          <label>Reason (min 200 characters)</label>
          <textarea className="w-full p-2 border rounded" value={form.reason} onChange={(e) => setForm({ ...form, reason: e.target.value })} rows={6} />
          <div className="flex justify-end">
            <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={() => submitWithdrawal(form)}>Submit & Download PDF</button>
          </div>
        </div>
      </div>
    );
  }

  function ProfileTab() {
    return (
      <div className="p-4">
        <h2 className="text-xl font-semibold mb-3">Profile</h2>
        <div className="bg-white p-4 rounded-2xl shadow space-y-3">
          <label>Full name</label>
          <input className="w-full p-2 border rounded" value={profile.fullName || ""} onChange={(e) => setProfile({ ...profile, fullName: e.target.value })} />
          <label>Phone</label>
          <input className="w-full p-2 border rounded" value={profile.phone || ""} onChange={(e) => setProfile({ ...profile, phone: e.target.value })} />
          <label>Member No</label>
          <input className="w-full p-2 border rounded" value={profile.memberNo || ""} onChange={(e) => setProfile({ ...profile, memberNo: e.target.value })} />
          <label>Residence</label>
          <input className="w-full p-2 border rounded" value={profile.residence || ""} onChange={(e) => setProfile({ ...profile, residence: e.target.value })} />
          <label>Education</label>
          <input className="w-full p-2 border rounded" value={profile.education || ""} onChange={(e) => setProfile({ ...profile, education: e.target.value })} />
          <label>Parent / Guardian</label>
          <input className="w-full p-2 border rounded" value={profile.parentName || ""} onChange={(e) => setProfile({ ...profile, parentName: e.target.value })} />
          <div className="flex justify-between">
            <div>
              <input type="file" onChange={(e) => uploadIDFile(e.target.files[0])} />
            </div>
            <div>
              <button className="px-3 py-1 bg-green-600 text-white rounded" onClick={handleProfileSave}>Save Profile</button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  function AccountStatementTab() {
    return (
      <div className="p-4">
        <h2 className="text-xl font-semibold mb-3">Account Statement</h2>
        <div className="bg-white p-4 rounded-2xl shadow">
          <p className="text-sm text-gray-600">Download a statement of your transactions.</p>
          <div className="mt-3 flex space-x-2">
            <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={downloadAccountStatement}>Download PDF Statement</button>
            <button className="px-3 py-1 border rounded" onClick={() => setActiveTab("dashboard")}>Back to dashboard</button>
          </div>
        </div>
      </div>
    );
  }

  function AdminPanel() {
    return (
      <div className="p-4">
        <h2 className="text-xl font-semibold mb-3">Admin Panel</h2>
        <div className="bg-white p-4 rounded-2xl shadow space-y-3">
          <h3 className="font-medium">Pending Applications</h3>
          {applications.filter(a => a.status === 'pending').length === 0 && <div className="text-sm text-gray-500">No pending applications</div>}
          {applications.filter(a => a.status === 'pending').map((a) => (
            <div key={a.id} className="p-2 border rounded">
              <div className="font-medium">{a.applicantProfile?.fullName || a.applicantEmail} — {formatCurrency(a.amount)}</div>
              <div className="text-xs text-gray-600">Applied: {new Date(a.createdAt).toLocaleString()}</div>
              <div className="mt-2 flex space-x-2">
                <button className="px-2 py-1 bg-green-600 text-white rounded" onClick={() => adminApproveApplication(a.id, true)}>Approve</button>
                <button className="px-2 py-1 bg-red-600 text-white rounded" onClick={() => adminApproveApplication(a.id, false)}>Reject</button>
                <button className="px-2 py-1 border rounded" onClick={() => { setActiveTab('accountStatement'); }}>Statement</button>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  // --- Simple Login UI for demo ---
  function AuthUI() {
    if (user) return (
      <div className="p-2 rounded bg-green-100 text-sm">Signed in as {user.email || user.uid} {isAdminUser(user.email) && <span className="ml-2 font-semibold">(Admin)</span>}</div>
    );

    return (
      <form onSubmit={handleLogin} className="space-y-2 p-2 bg-white rounded shadow w-full md:w-1/2">
        <div className="text-sm font-medium">Sign in</div>
        <input className="w-full p-2 border rounded" placeholder="Email" value={loginForm.email} onChange={(e) => setLoginForm({ ...loginForm, email: e.target.value })} />
        <input type="password" className="w-full p-2 border rounded" placeholder="Password" value={loginForm.password} onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })} />
        <button className="px-3 py-1 bg-blue-600 text-white rounded">Sign in</button>
      </form>
    );
  }

  return (
    <div className="min-h-screen bg-gray-100 p-6">
      <div className="max-w-6xl mx-auto">
        <header className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-2xl font-bold">Visionary Youth Group Portal</h1>
            <div className="text-sm text-gray-600">Modern portal for members — balances, loans, withdrawals, and admin</div>
          </div>
          <div className="space-x-2">
            <AuthUI />
          </div>
        </header>

        <div className="flex space-x-4">
          <aside className="w-72">
            <div className="bg-white p-3 rounded-2xl shadow">
              <div className="font-medium">Menu</div>
              <nav className="mt-3 space-y-2 text-sm">
                <button className={`w-full text-left p-2 rounded ${activeTab === 'dashboard' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('dashboard')}>Dashboard</button>
                <button className={`w-full text-left p-2 rounded ${activeTab === 'loanWizard' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('loanWizard')}>Loan Wizard</button>
                <button className={`w-full text-left p-2 rounded ${activeTab === 'withdrawals' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('withdrawals')}>Withdrawal Form</button>
                <button className={`w-full text-left p-2 rounded ${activeTab === 'profile' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('profile')}>Profile</button>
                <button className={`w-full text-left p-2 rounded ${activeTab === 'accountStatement' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('accountStatement')}>Account Statement</button>
                {user && isAdminUser(user.email) && <button className={`w-full text-left p-2 rounded ${activeTab === 'admin' ? 'bg-blue-600 text-white' : 'hover:bg-gray-50'}`} onClick={() => setActiveTab('admin')}>Admin</button>}
              </nav>
            </div>

            <div className="mt-4 bg-white p-3 rounded-2xl shadow text-sm">
              <div className="font-medium">Quick Stats</div>
              <div className="mt-2">Points: <span className="font-semibold">{points}</span></div>
              <div>Loans: <span className="font-semibold">{loans.length}</span></div>
              <div className="mt-2">
                <button className="px-2 py-1 bg-blue-600 text-white rounded text-xs" onClick={() => awardPoints(user?.uid, 5)}>Claim 5 pts</button>
              </div>
            </div>
          </aside>

          <main className="flex-1">
            {activeTab === 'dashboard' && <DashboardTab />}
            {activeTab === 'loanWizard' && <LoanWizard />}
            {activeTab === 'withdrawals' && <WithdrawalsTab />}
            {activeTab === 'profile' && <ProfileTab />}
            {activeTab === 'accountStatement' && <AccountStatementTab />}
            {activeTab === 'admin' && isAdminUser(user?.email) && <AdminPanel />}
          </main>
        </div>
      </div>
    </div>
  );
}
