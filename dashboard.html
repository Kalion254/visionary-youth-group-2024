<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visionary Youth Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* ---------- Global UI ---------- */
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #fff;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  background: rgba(21, 101, 192, 0.9);
  backdrop-filter: blur(6px);
  color: white;
  padding: 15px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

header h1 {
  margin: 0;
  font-size: 24px;
  display: flex;
  align-items: center;
  gap: 10px;
}

header h1 i {
  color: #ffeb3b;
}

nav {
  display: flex;
  gap: 10px;
  background: rgba(0,0,0,0.25);
  padding: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

nav button {
  padding: 12px 18px;
  border: none;
  border-radius: 12px;
  background: rgba(255,255,255,0.15);
  color: white;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
}

nav button:hover {
  background: #1565c0;
  transform: translateY(-2px);
}

nav button.active {
  background: #0d47a1;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
}

.container {
  flex: 1;
  padding: 20px;
}

.section {
  display: none;
  background: rgba(255,255,255,0.08);
  padding: 20px;
  border-radius: 15px;
  backdrop-filter: blur(6px);
  margin-top: 20px;
  animation: fadeIn 0.4s ease;
}

.section.active {
  display: block;
}

@keyframes fadeIn {
  from {opacity:0; transform: translateY(10px);}
  to {opacity:1; transform: translateY(0);}
}

/* ---------- Mini Tabs ---------- */
.mini-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
}

.mini-btn {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 10px;
  background: rgba(255,255,255,0.15);
  color: white;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}

.mini-btn.active, .mini-btn:hover {
  background: #2196f3;
}

.mini-section { display: none; }
.mini-section.active { display: block; }

/* ---------- Progress Bars ---------- */
.progress-bar {
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  overflow: hidden;
  margin: 10px 0;
  height: 20px;
}

.progress-fill {
  background: #ffeb3b;
  height: 100%;
  width: 0;
  border-radius: 20px;
  transition: width 1s ease-in-out;
}

/* ---------- Achievements ---------- */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

.achievement-card {
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.25);
  text-align: center;
  transition: transform 0.2s;
}

.achievement-card:hover { transform: scale(1.05); }
.achievement-card i { font-size: 40px; color: #ffeb3b; margin-bottom: 12px; }

.achievement-card button {
  background: #2196f3;
  border: none;
  color: white;
  padding: 8px 15px;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
}

.achievement-card button:hover { background: #1565c0; }

/* ---------- Forms ---------- */
form input, form select {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: none;
  outline: none;
}

form button {
  background: #1565c0;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
  transition: 0.3s;
}

form button:hover { background: #0d47a1; }

/* ---------- Footer ---------- */
footer {
  background: rgba(0,0,0,0.4);
  padding: 15px;
  text-align: center;
  font-size: 14px;
  color: #ddd;
}

footer a { color: #ffeb3b; margin: 0 5px; text-decoration: none; }
footer a:hover { text-decoration: underline; }
</style>
</head>
<body>
<header>
  <h1><i class="fa-solid fa-users"></i> Visionary Youth</h1>
  <div id="emailDisplay" style="font-weight:bold;"></div>
  <button id="logoutBtn">Logout</button>
</header>

<nav>
  <button class="tab-btn active" data-target="financial"><i class="fa-solid fa-chart-line"></i> Financial</button>
  <button class="tab-btn" data-target="profile"><i class="fa-solid fa-user"></i> Profile</button>
  <button class="tab-btn" data-target="loan"><i class="fa-solid fa-money-check-dollar"></i> Loan</button>
  <button class="tab-btn" data-target="loanProgress"><i class="fa-solid fa-clock"></i> Progress</button>
  <button class="tab-btn" data-target="achievements"><i class="fa-solid fa-award"></i> Achievements</button>
  <button class="tab-btn" data-target="statement"><i class="fa-solid fa-file-invoice"></i> Statement</button>
</nav>

<div class="container">
  <!-- Financial -->
  <div id="financial" class="section active">
    <h2>üìä Financial Overview</h2>
    <div class="mini-tabs">
      <button class="mini-btn active" data-mini="savings">Savings</button>
      <button class="mini-btn" data-mini="shares">Shares</button>
      <button class="mini-btn" data-mini="loans">Loans</button>
      <button class="mini-btn" data-mini="balances">Balances</button>
      <button class="mini-btn" data-mini="dividends">Dividends</button>
    </div>

    <div id="savings" class="mini-section active">
      <p>Weekly Savings: <span id="weeklySavings">0</span></p>
      <div class="progress-bar"><div id="weeklyBar" class="progress-fill"></div></div>
      <p>Monthly Savings: <span id="monthlySavings">0</span></p>
      <div class="progress-bar"><div id="monthlyBar" class="progress-fill"></div></div>
    </div>
    <div id="shares" class="mini-section">
      <p>Shares: <span id="shares">0</span></p>
      <div class="progress-bar"><div id="sharesBar" class="progress-fill"></div></div>
    </div>
    <div id="loans" class="mini-section">
      <p>Loan: <span id="loan">0</span></p>
      <div class="progress-bar"><div id="loanBar" class="progress-fill"></div></div>
    </div>
    <div id="balances" class="mini-section">
      <p>Unpaid Balances: <span id="unpaidBalances">0</span></p>
      <div class="progress-bar"><div id="balancesBar" class="progress-fill"></div></div>
    </div>
    <div id="dividends" class="mini-section">
      <p>Dividends: <span id="dividends">0</span></p>
      <div class="progress-bar"><div id="dividendsBar" class="progress-fill"></div></div>
    </div>
  </div>

  <!-- Profile -->
  <div id="profile" class="section">
    <h2>üë§ Profile Update</h2>
    <form id="profileForm">
      <label>Name</label><input id="profileName" required>
      <label>ID</label><input id="profileID" required>
      <label>Email</label><input type="email" id="profileEmail" required>
      <label>Phone</label><input id="profilePhone" required>
      <label>Origin</label><input id="profileOrigin" required>
      <label>Member Number</label><input id="profileMember" required>
      <label>Passport</label><input type="file" id="passport" accept="image/*" required>
      <button type="submit">Update Profile</button>
    </form>
  </div>

  <!-- Loan -->
  <div id="loan" class="section">
    <h2>üíµ Loan Application</h2>
    <form id="loanForm">
      <label>Name</label><input id="loanName" required>
      <label>Amount</label><input id="loanAmount" required>
      <label>Category</label>
      <select id="loanCategory" required>
        <option value="">Select</option>
        <option>Business</option>
        <option>Education</option>
        <option>Emergency</option>
      </select>
      <label>Guarantor</label><input id="loanGuarantor" required>
      <label>Phone</label><input id="loanPhone" required>
      <button type="submit">Apply</button>
    </form>
    <button id="downloadLoanBtn" style="display:none;">Download Loan CSV</button>
  </div>

  <!-- Loan Progress -->
  <div id="loanProgress" class="section">
    <h2>üìÖ Loan Progress</h2>
    <div id="loanTimeline"></div>
  </div>

  <!-- Achievements -->
  <div id="achievements" class="section">
    <h2>üèÖ Achievements & Documents</h2>
    <div id="achievementList" class="achievements-grid"></div>
  </div>

  <!-- Statement -->
  <div id="statement" class="section">
    <h2>üìë Account Statement</h2>
    <button id="downloadStatementBtn">Download CSV</button>
  </div>
</div>

<footer>
  <p>¬© 2025 Visionary Youth Group | Powered by Firebase</p>
  <p><a href="#">About</a> | <a href="#">Contact</a> | <a href="#">Support</a></p>
</footer>

<script>
/* üîπ Firebase Config */
const firebaseConfig={/* your config here */};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();
let currentUserUid;

/* üîπ Tabs */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.getElementById(btn.dataset.target).classList.add("active");
    btn.classList.add("active");
  });
});

/* üîπ Mini Tabs */
document.querySelectorAll(".mini-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".mini-section").forEach(s=>s.classList.remove("active"));
    document.querySelectorAll(".mini-btn").forEach(b=>b.classList.remove("active"));
    document.getElementById(btn.dataset.mini).classList.add("active");
    btn.classList.add("active");
  });
});

/* üîπ Logout */
document.getElementById("logoutBtn").addEventListener("click",()=>auth.signOut().then(()=>window.location.href="index.html"));

/* üîπ Auth */
auth.onAuthStateChanged(user=>{
  if(user){
    currentUserUid=user.uid;
    document.getElementById("emailDisplay").textContent="Welcome, "+user.email;
    loadFinancials(); loadLoanProgress(); loadAchievements();
  } else { window.location.href="index.html"; }
});

/* üîπ Financials with progress bars */
function animateBar(id,value,max=10000){
  const bar=document.getElementById(id);
  const width=Math.min((value/max)*100,100);
  setTimeout(()=>{ bar.style.width=width+"%"; },200);
}

function loadFinancials(){
  db.ref(`users/${currentUserUid}/financials`).on("value",snap=>{
    const d=snap.val()||{};
    weeklySavings.textContent=d.weekly_savings||0;
    monthlySavings.textContent=d.monthly_savings||0;
    shares.textContent=d.shares||0;
    loan.textContent=d.loan||0;
    unpaidBalances.textContent=d.unpaid_balances||0;
    dividends.textContent=d.dividends||0;

    animateBar("weeklyBar",d.weekly_savings||0);
    animateBar("monthlyBar",d.monthly_savings||0);
    animateBar("sharesBar",d.shares||0);
    animateBar("loanBar",d.loan||0);
    animateBar("balancesBar",d.unpaid_balances||0);
    animateBar("dividendsBar",d.dividends||0);
  });
}

/* üîπ Profile Update */
profileForm.addEventListener("submit",async e=>{
  e.preventDefault();
  const file=document.getElementById("passport").files[0];
  const storageRef=storage.ref(`passports/${currentUserUid}`);
  await storageRef.put(file);
  const url=await storageRef.getDownloadURL();
  await db.ref(`users/${currentUserUid}/profile`).set({
    name:profileName.value,id:profileID.value,email:profileEmail.value,
    phone:profilePhone.value,origin:profileOrigin.value,
    memberNumber:profileMember.value,passportURL:url
  });
  alert("‚úÖ Profile updated successfully!");
});

/* üîπ Loan Application */
loanForm.addEventListener("submit",async e=>{
  e.preventDefault();
  if(!loanName.value||!loanAmount.value||!loanCategory.value||!loanGuarantor.value||!loanPhone.value){
    alert("‚ö†Ô∏è Fill all loan fields."); return;
  }
  const loanData={ personal:{name:loanName.value},
    loanDetails:{amount:loanAmount.value,category:loanCategory.value},
    guarantor:{name:loanGuarantor.value,phone:loanPhone.value},
    status:"Applied",timestamp:Date.now() };
  const ref=await db.ref(`users/${currentUserUid}/loan_applications`).push(loanData);
  alert("üéâ Loan application submitted!");
  downloadLoanBtn.style.display="block";
  downloadLoanBtn.onclick=()=>downloadLoanCSV(ref.key);
});

/* üîπ Loan CSV */
function downloadLoanCSV(loanKey){
  db.ref(`users/${currentUserUid}/loan_applications/${loanKey}`).once('value').then(snap=>{
    const d=snap.val(); let csv="Section,Field,Value\n";
    for(let sec in d) for(let key in d[sec]) csv+=`${sec},${key},${d[sec][key]}\n`;
    const blob=new Blob([csv],{type:'text/csv'});
    const link=document.createElement('a'); link.href=URL.createObjectURL(blob);
    link.download='loan_application.csv'; link.click();
  });
}

/* üîπ Loan Progress */
function loadLoanProgress(){
  loanTimeline.innerHTML="";
  db.ref(`users/${currentUserUid}/loan_applications`).on('value',snap=>{
    loanTimeline.innerHTML="";
    snap.forEach(child=>{
      const loan=child.val();
      const stages=["Applied","Registered","Verified","Allocation","Disbursement in Progress","Disbursed"];
      stages.forEach(stage=>{
        const div=document.createElement("div");
        div.innerHTML=`<i class="fa-solid fa-circle-check"></i> ${stage} - Amount: ${loan.loanDetails.amount} - Status: ${loan.status}`;
        loanTimeline.appendChild(div);
      });
    });
  });
}

/* üîπ Achievements */
function loadAchievements(){
  achievementList.innerHTML="";
  db.ref(`users/${currentUserUid}/achievements`).on("value",snap=>{
    achievementList.innerHTML="";
    const data=snap.val()||{};
    if(Object.keys(data).length===0){ achievementList.innerHTML="<p>No achievements yet</p>"; return; }
    for(const key in data){
      const a=data[key];
      achievementList.innerHTML+=`
        <div class="achievement-card">
          <i class="fa-solid fa-certificate"></i>
          <h3>${a.title}</h3>
          <p>${a.description}</p>
          <button onclick="downloadAchievement('${key}')">Download</button>
        </div>`;
    }
  });
}
function downloadAchievement(id){
  db.ref(`users/${currentUserUid}/achievements/${id}`).once("value").then(snap=>{
    const d=snap.val(); const blob=new Blob([`Achievement: ${d.title}\n${d.description}`],{type:"text/plain"});
    const link=document.createElement("a"); link.href=URL.createObjectURL(blob);
    link.download="achievement.txt"; link.click();
  });
}

/* üîπ Statement Download */
downloadStatementBtn.addEventListener("click",()=>{
  db.ref(`users/${currentUserUid}/financials`).once('value').then(snap=>{
    const d=snap.val()||{}; let csv="Field,Value\n";
    for(let k in d) csv+=`${k},${d[k]}\n`;
    const blob=new Blob([csv],{type:'text/csv'});
    const link=document.createElement("a"); link.href=URL.createObjectURL(blob);
    link.download="statement.csv"; link.click();
  });
});
</script>
</body>
</html>
