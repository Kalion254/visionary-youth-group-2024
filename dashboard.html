<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VISIONARY YOUTH GROUP 2024 - Dashboard</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- AOS Animations -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">

<style>
body { margin:0; font-family:'Poppins',sans-serif; background:#f0f2f5; color:#333; }
header { padding:20px; background:#007bff; color:white; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5rem; }
header button { background:#ff6600; border:none; padding:10px 15px; border-radius:8px; color:white; cursor:pointer; transition:0.3s; }
header button:hover { transform:scale(1.05); }
.container { padding:30px; max-width:1200px; margin:auto; }
.cards, .loans { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
.card, .loan-card { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); transition:transform 0.3s; }
.card:hover, .loan-card:hover { transform:scale(1.03); }
.card h3, .loan-card h3 { margin-top:0; color:#007bff; }
.card p, .loan-card p { margin:5px 0; }
.loan-card .status { font-weight:bold; padding:5px 10px; border-radius:6px; display:inline-block; color:white; }
.status.Pending { background:#ffcc00; }
.status.Verified { background:#28a745; }
.status.Rejected { background:#dc3545; }
.download-btn { background:#007bff; color:white; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; margin-top:10px; display:inline-block; text-decoration:none; }
.download-btn:hover { background:#ff6600; }
h2 { text-align:center; margin-bottom:25px; color:#007bff; }
</style>
</head>
<body>

<header>
  <h1>Member Dashboard</h1>
  <button onclick="logout()">Logout</button>
</header>

<div class="container" data-aos="fade-up">
  <h2>Personal Details</h2>
  <div class="cards">
    <div class="card"><h3>Name</h3><p id="dashName">Loading...</p></div>
    <div class="card"><h3>Phone</h3><p id="dashPhone">Loading...</p></div>
    <div class="card"><h3>ID Number</h3><p id="dashId">Loading...</p></div>
    <div class="card"><h3>Place of Origin</h3><p id="dashOrigin">Loading...</p></div>
    <div class="card"><h3>Email</h3><p id="dashEmail">Loading...</p></div>
  </div>

  <h2>Loan Applications</h2>
  <div class="loans" id="loanList">
    <!-- Loan cards will be dynamically populated here -->
  </div>

  <h2>Download Statement</h2>
  <a href="#" class="download-btn" id="downloadStatement">Download PDF</a>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
  authDomain: "visionary-youth-grou-2024.firebaseapp.com",
  projectId: "visionary-youth-grou-2024",
  storageBucket: "visionary-youth-grou-2024.firebasestorage.app",
  messagingSenderId: "372978592717",
  appId: "1:372978592717:web:1c15aec728ee5f854f3284",
  measurementId: "G-QP1RBT2ZCP"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore(app);

window.logout = async () => { await signOut(auth); window.location.href = "index.html"; };

// Load dashboard data
onAuthStateChanged(auth, async user => {
  if(user){
    const docSnap = await getDoc(doc(db, "members", user.uid));
    if(docSnap.exists()){
      const data = docSnap.data();
      document.getElementById('dashName').innerText = data.name;
      document.getElementById('dashPhone').innerText = data.phone;
      document.getElementById('dashId').innerText = data.id;
      document.getElementById('dashOrigin').innerText = data.origin;
      document.getElementById('dashEmail').innerText = data.email;
    }

    // Load loans
    const loansRef = collection(db, "members", user.uid, "loans");
    const loanSnap = await getDocs(loansRef);
    const loanList = document.getElementById('loanList');
    loanList.innerHTML = "";
    loanSnap.forEach(docu => {
      const l = docu.data();
      loanList.innerHTML += `
        <div class="loan-card">
          <h3>${l.title || "Loan"}</h3>
          <p><strong>Amount:</strong> ${l.amount}</p>
          <p><strong>Date Applied:</strong> ${l.date}</p>
          <p><span class="status ${l.status}">${l.status}</span></p>
        </div>
      `;
    });

  } else {
    window.location.href = "index.html"; // redirect if not logged in
  }
});

// Download statement
document.getElementById('downloadStatement').addEventListener('click', (e)=>{
  e.preventDefault();
  alert("Feature coming soon: Download PDF statement functionality.");
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script>AOS.init({ duration:1000, once:true });</script>

</body>
</html>
