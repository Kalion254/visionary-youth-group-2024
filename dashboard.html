<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VISIONARY YOUTH GROUP 2024 - Dashboard</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<style>
body { font-family:'Poppins',sans-serif; background:#f0f2f5; color:#333; }
header { background:linear-gradient(135deg,#1e3a8a,#3b82f6); color:white; padding:25px; text-align:center; border-radius:0 0 12px 12px; }
header h1 { font-size:2rem; margin:0; }
.container { max-width:1200px; margin:20px auto; padding:0 20px; }
.dashboard-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.card { background:white; padding:25px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center; transition:0.3s; }
.card i { font-size:40px; margin-bottom:10px; color:#f59e0b; }
.balance { font-size:1.5rem; font-weight:700; margin-top:5px; }
.tabs { display:flex; justify-content:center; margin-top:30px; border-bottom:2px solid #e5e7eb; }
.tab { padding:12px 25px; cursor:pointer; font-weight:600; color:#374151; transition:0.3s; }
.tab-active { border-bottom:4px solid #3b82f6; color:#3b82f6; }
.tab-content { margin-top:20px; display:none; }
.tab-content.active { display:block; }
form input, form select, form textarea { display:block; width:100%; margin:10px 0; padding:10px; border-radius:8px; border:1px solid #ccc; }
form button { background:#3b82f6; color:white; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; transition:0.3s; }
form button:hover { background:#1e40af; }
.progress-bar { height:20px; border-radius:10px; background:#e2e8f0; overflow:hidden; margin-top:10px; width:100%; }
.progress-bar-inner { height:100%; background:#f59e0b; width:0%; text-align:center; color:white; font-weight:600; line-height:20px; transition:width 0.5s; }
</style>
</head>
<body>

<header>
  <h1>Welcome to Your Dashboard</h1>
  <p>VISIONARY YOUTH GROUP 2024</p>
</header>

<div class="container">
  <!-- Cards showing balances -->
  <div class="dashboard-cards">
    <div class="card">
      <i class="fas fa-calendar-week"></i>
      <h3>Weekly Savings</h3>
      <p class="balance" id="weeklySavings">Ksh 0</p>
    </div>
    <div class="card">
      <i class="fas fa-calendar-alt"></i>
      <h3>Monthly Savings</h3>
      <p class="balance" id="monthlySavings">Ksh 0</p>
    </div>
    <div class="card">
      <i class="fas fa-hand-holding-usd"></i>
      <h3>Loan Outstanding</h3>
      <p class="balance" id="loanOutstanding">Ksh 0</p>
      <div class="progress-bar">
        <div id="loanProgress" class="progress-bar-inner">0%</div>
      </div>
    </div>
    <div class="card">
      <i class="fas fa-money-bill-wave"></i>
      <h3>Loan Repaid</h3>
      <p class="balance" id="loanRepaid">Ksh 0</p>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab tab-active" data-target="overview">Overview</div>
    <div class="tab" data-target="applyLoan">Apply Loan</div>
  </div>

  <!-- Tab Contents -->
  <div id="overview" class="tab-content active">
    <h3>Account Overview</h3>
    <p>Check your balances and loan status above.</p>
  </div>

  <div id="applyLoan" class="tab-content">
    <h3>Apply for Loan</h3>
    <form id="loanForm">
      <input type="text" id="loanPurpose" placeholder="Loan Purpose" required>
      <input type="number" id="loanAmount" placeholder="Loan Amount (Ksh)" required>
      <select id="loanDuration" required>
        <option value="">Select Duration</option>
        <option value="1 Month">1 Month</option>
        <option value="3 Months">3 Months</option>
        <option value="6 Months">6 Months</option>
      </select>
      <button type="button" id="submitLoan">Submit Application</button>
    </form>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
  authDomain: "visionary-youth-grou-2024.firebaseapp.com",
  databaseURL: "https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
  projectId: "visionary-youth-grou-2024",
  storageBucket: "visionary-youth-grou-2024.appspot.com",
  messagingSenderId: "372978592717",
  appId: "1:372978592717:web:624596619d41aab84f3284",
  measurementId: "G-FEHC1GM3B7"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// Tabs
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('tab-active'));
    tab.classList.add('tab-active');
    document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
    document.getElementById(tab.dataset.target).classList.add('active');
  });
});

// User data
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="index.html";

  const uid=user.uid;
  
  // Weekly Savings
  db.ref('members/'+uid+'/weeklySavings').on('value',snap=>{
    let total=0; snap.forEach(c=>total+=Number(c.val().amount));
    document.getElementById('weeklySavings').innerText="Ksh "+total.toLocaleString();
  });

  // Monthly Savings
  db.ref('members/'+uid+'/monthlySavings').on('value',snap=>{
    let total=0; snap.forEach(c=>total+=Number(c.val().amount));
    document.getElementById('monthlySavings').innerText="Ksh "+total.toLocaleString();
  });

  // Loan
  db.ref('members/'+uid+'/loan').on('value',snap=>{
    if(snap.exists()){
      const loan=snap.val();
      const progress = loan.progress||0;
      document.getElementById('loanProgress').style.width=progress+"%";
      document.getElementById('loanProgress').innerText=progress+"%";
      document.getElementById('loanOutstanding').innerText="Ksh "+Number(loan.amount||0).toLocaleString();
      document.getElementById('loanRepaid').innerText="Ksh "+Number(loan.repaid||0).toLocaleString();
    }
  });
});

// Submit Loan Application
document.getElementById('submitLoan').addEventListener('click',()=>{
  const user=firebase.auth().currentUser;
  if(!user) return alert("Login required");
  const uid=user.uid;
  const data={
    purpose: document.getElementById('loanPurpose').value,
    amount: Number(document.getElementById('loanAmount').value),
    duration: document.getElementById('loanDuration').value,
    status: 'Pending',
    appliedAt: new Date().toISOString()
  };
  if(!data.purpose || !data.amount || !data.duration) return alert("Fill all fields");
  db.ref('members/'+uid+'/loanApplications').push(data);
  alert("Loan application submitted!");
  document.getElementById('loanForm').reset();
});
</script>

</body>
</html>
