<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Dashboard - Visionary Youth Group</title>

<!-- Tailwind CSS & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body { font-family:'Poppins',sans-serif; background: linear-gradient(to right, #f0f2f5, #e0f7fa); }
.card { background:white; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1); padding:20px; transition:0.3s; }
.card:hover { transform: scale(1.03); }
.balance { font-size:1.5rem; font-weight:700; color:#1f2937; }
.progress-bar { height:20px; border-radius:10px; background:#e2e8f0; overflow:hidden; }
.progress-bar-inner { height:100%; background:#f59e0b; width:0%; text-align:center; color:white; font-weight:600; line-height:20px; transition:width 0.5s; }
</style>
</head>
<body>

<header class="bg-blue-700 text-white p-4 flex justify-between items-center shadow-lg">
  <h1 class="text-2xl font-bold">Member Dashboard</h1>
  <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded flex items-center">
    <i class="fas fa-sign-out-alt mr-2"></i>Logout
  </button>
</header>

<main class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">

  <!-- Savings Card -->
  <div class="card flex flex-col items-center">
    <i class="fas fa-piggy-bank text-yellow-500 text-4xl mb-2"></i>
    <h2 class="text-xl font-semibold text-gray-700">Savings</h2>
    <p class="balance" id="savingsBalance">Ksh 0</p>
  </div>

  <!-- Shares Card -->
  <div class="card flex flex-col items-center">
    <i class="fas fa-chart-pie text-pink-500 text-4xl mb-2"></i>
    <h2 class="text-xl font-semibold text-gray-700">Shares</h2>
    <p class="balance" id="sharesBalance">Ksh 0</p>
  </div>

  <!-- Loan Card -->
  <div class="card flex flex-col items-center">
    <i class="fas fa-hand-holding-usd text-green-500 text-4xl mb-2"></i>
    <h2 class="text-xl font-semibold text-gray-700">Loan Balance</h2>
    <p class="balance" id="loanBalance">Ksh 0</p>
    <div class="progress-bar w-full mt-3">
      <div id="loanProgress" class="progress-bar-inner">0%</div>
    </div>
    <p class="mt-2 font-medium text-gray-600" id="loanStatus">No active loan</p>
  </div>

  <!-- Recent Activity -->
  <div class="card col-span-full">
    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center"><i class="fas fa-history mr-2"></i> Recent Activity</h2>
    <ul id="recentActivity" class="space-y-2 text-gray-600"></ul>
  </div>

</main>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
  authDomain: "visionary-youth-grou-2024.firebaseapp.com",
  databaseURL: "https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
  projectId: "visionary-youth-grou-2024",
  storageBucket: "visionary-youth-grou-2024.firebasestorage.app",
  messagingSenderId: "372978592717",
  appId: "1:372978592717:web:624596619d41aab84f3284",
  measurementId: "G-FEHC1GM3B7"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// Logout
function logout(){ auth.signOut().then(()=>window.location.href="index.html"); }

// Load balances & loan status
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href="index.html"; return; }

  // Savings
  db.ref("members/"+user.uid+"/savings").on("value", snap=>{
    let total=0;
    snap.forEach(child=>total+=Number(child.val().amount));
    document.getElementById("savingsBalance").innerText="Ksh "+total.toLocaleString();
  });

  // Shares
  db.ref("members/"+user.uid+"/shares").on("value", snap=>{
    let total=0;
    snap.forEach(child=>total+=Number(child.val().amount));
    document.getElementById("sharesBalance").innerText="Ksh "+total.toLocaleString();
  });

  // Loan
  db.ref("members/"+user.uid+"/loan").on("value", snap=>{
    if(snap.exists()){
      const loan = snap.val();
      const progress = loan.progress || 0;
      document.getElementById("loanProgress").style.width=progress+"%";
      document.getElementById("loanProgress").innerText=progress+"%";
      document.getElementById("loanBalance").innerText="Ksh "+Number(loan.amount||0).toLocaleString();
      document.getElementById("loanStatus").innerText=loan.status || "Pending";
    }
  });

  // Recent Activity
  const activityList = document.getElementById("recentActivity");
  const activityPaths = ["savings","shares","repayments"];
  activityPaths.forEach(path=>{
    db.ref("members/"+user.uid+"/"+path).on("value", snap=>{
      let items=[];
      snap.forEach(child=>{
        const val=child.val();
        if(path==="repayments") items.push(`Repayment: Ksh ${val.amount} on ${val.date}`);
        else if(path==="savings") items.push(`Saved: Ksh ${val.amount} on ${val.date}`);
        else if(path==="shares") items.push(`Shares: Ksh ${val.amount} on ${val.date}`);
      });
      items.reverse(); // most recent first
      activityList.innerHTML=items.map(i=>`<li>${i}</li>`).join('');
    });
  });

});
</script>

</body>
</html>
