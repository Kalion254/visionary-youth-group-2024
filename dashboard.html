<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visionary Youth Group - Dashboard</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { margin: 0; font-family: 'Poppins', sans-serif; background: #e6f7e6; color: #333; }

    nav {
      background: #006400; color: white; padding: 15px 20px;
      display: flex; justify-content: space-between; align-items: center;
    }
    nav h1 { font-size: 1.3rem; margin: 0; }
    nav .menu-btn { font-size: 24px; cursor: pointer; }
    nav .user-info { font-size: 0.9rem; text-align: right; }

    .sidebar {
      position: fixed; top: 0; left: -250px; width: 250px; height: 100%;
      background: #111; color: white; transition: 0.3s; padding-top: 60px; z-index: 999;
    }
    .sidebar.active { left: 0; }
    .sidebar a {
      display: block; padding: 15px; color: white; text-decoration: none;
    }
    .sidebar a:hover { background: #006400; }

    .main { padding: 20px; }
    section { display: none; }
    section.active { display: block; }

    .cards {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }
    .card {
      background: white; padding: 20px; border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;
    }
    .card i { font-size: 35px; color: #ffcc00; margin-bottom: 10px; }

    /* Loan progress stages */
    .stages { display: flex; gap: 15px; justify-content: space-between; margin-top: 20px; }
    .stage {
      flex: 1; padding: 10px; border-radius: 8px; text-align: center; font-size: 0.85rem;
      background: #f1f1f1; color: #555;
    }
    .stage.active { background: #006400; color: white; font-weight: 600; }
    .stage.completed { background: #28a745; color: white; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav>
    <span class="menu-btn" onclick="toggleSidebar()">â˜°</span>
    <h1>Visionary Youth Group</h1>
    <div class="user-info">
      <span id="userEmail">Loading...</span><br>
      <small>Status: <span style="color:lightgreen;">Active</span></small>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="#" data-target="overview"><i class="fas fa-home"></i> Overview</a>
    <a href="#" data-target="savings"><i class="fas fa-piggy-bank"></i> Savings</a>
    <a href="#" data-target="loans"><i class="fas fa-hand-holding-usd"></i> Loans</a>
    <a href="#" data-target="loanApp"><i class="fas fa-file-signature"></i> Loan Application</a>
    <a href="#" data-target="shares"><i class="fas fa-chart-pie"></i> Shares & Dividends</a>
    <a href="#" data-target="statement"><i class="fas fa-file-pdf"></i> Account Statement</a>
    <a href="#" data-target="profile"><i class="fas fa-user-cog"></i> Update Profile</a>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Overview -->
    <section id="overview" class="active">
      <h2>Dashboard Overview</h2>
      <div class="cards">
        <div class="card"><i class="fas fa-piggy-bank"></i><h3>Weekly Savings</h3><p>Ksh <span id="weeklySavings">0</span></p></div>
        <div class="card"><i class="fas fa-calendar-alt"></i><h3>Monthly Savings</h3><p>Ksh <span id="monthlySavings">0</span></p></div>
        <div class="card"><i class="fas fa-hand-holding-usd"></i><h3>Loans</h3><p>Ksh <span id="loanBalance">0</span></p></div>
      </div>
    </section>

    <!-- Savings -->
    <section id="savings"><h2>Your Savings</h2></section>

    <!-- Loans -->
    <section id="loans">
      <h2>Your Loans</h2>
      <p>Loan Balance: Ksh <span id="loanBalance2">0</span></p>
      <div class="stages">
        <div id="stage-applied" class="stage">Applied</div>
        <div id="stage-approved" class="stage">Approved</div>
        <div id="stage-disbursed" class="stage">Disbursed</div>
        <div id="stage-repayment" class="stage">Repayment</div>
        <div id="stage-completed" class="stage">Completed</div>
      </div>
    </section>

    <!-- Other sections omitted for brevity (loanApp, shares, profile, etc.) -->
  </div>

  <!-- Firebase + JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
      authDomain: "visionary-youth-grou-2024.firebaseapp.com",
      databaseURL: "https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
      projectId: "visionary-youth-grou-2024",
      storageBucket: "visionary-youth-grou-2024.appspot.com",
      messagingSenderId: "372978592717",
      appId: "1:372978592717:web:1c15aec728ee5f854f3284"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Sidebar toggle
    window.toggleSidebar = () => document.getElementById("sidebar").classList.toggle("active");

    // Sidebar links -> switch sections
    document.querySelectorAll(".sidebar a").forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        const target = link.dataset.target;
        document.querySelectorAll(".main section").forEach(s => s.classList.remove("active"));
        document.getElementById(target).classList.add("active");
        document.getElementById("sidebar").classList.remove("active"); // close sidebar
      });
    });

    // Auth state
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("userEmail").textContent = user.email;
        const snapshot = await get(ref(db, "members/" + user.uid));
        if (snapshot.exists()) {
          const data = snapshot.val();
          document.getElementById("weeklySavings").textContent = data.weeklySavings || 0;
          document.getElementById("monthlySavings").textContent = data.monthlySavings || 0;
          document.getElementById("loanBalance").textContent = data.loanBalance || 0;
          document.getElementById("loanBalance2").textContent = data.loanBalance || 0;

          // Loan stage logic (example: use data.loanStage from DB)
          const stage = data.loanStage || "applied"; // fallback
          highlightStage(stage);
        }
      } else {
        window.location.href = "index.html";
      }
    });

    function highlightStage(stage) {
      const stages = ["applied","approved","disbursed","repayment","completed"];
      stages.forEach(s => {
        const el = document.getElementById("stage-" + s);
        el.classList.remove("active","completed");
      });

      const currentIndex = stages.indexOf(stage);
      stages.forEach((s, i) => {
        const el = document.getElementById("stage-" + s);
        if (i < currentIndex) el.classList.add("completed");
        else if (i === currentIndex) el.classList.add("active");
      });
    }
  </script>
</body>
</html>
