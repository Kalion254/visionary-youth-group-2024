<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VYG — Admin Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:url('https://images.unsplash.com/photo-1522071820081-009f0129c71c?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
}
body::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.58);
  backdrop-filter:blur(3px);
}
.container{
  position:relative;
  width:90%;
  max-width:430px;
  background:white;
  padding:35px 28px;
  border-radius:14px;
  box-shadow:0 8px 32px rgba(0,0,0,0.25);
  animation:fadeIn 0.4s ease-in-out;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}
h2{text-align:center;color:#004d26;margin-bottom:20px;font-weight:600;}
label{font-weight:500;margin-top:12px;display:block;color:#222;}
input,select{width:100%;padding:12px;border-radius:8px;border:1px solid #ccc;margin-top:5px;font-size:15px;}
input:focus,select:focus{border-color:#007a3d;outline:none;}
button{width:100%;padding:12px;margin-top:22px;background:#007a3d;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:16px;transition:0.25s;}
button:hover{background:#005e2e;}
.toggle-link{text-align:center;margin-top:14px;}
.toggle-link a{text-decoration:none;color:#007a3d;font-weight:500;}
.toggle-link a:hover{text-decoration:underline;}
.error{color:red;font-size:14px;margin-top:6px;}
.success{color:green;font-size:14px;margin-top:6px;}
@media(max-width:480px){
  .container{padding:25px 18px;}
  h2{font-size:20px;}
}
</style>
</head>

<body>

<div class="container" id="authContainer">

  <h2 id="formTitle">Admin Login</h2>

  <!-- LOGIN FORM -->
  <form id="loginForm">
    <label>Email</label>
    <input type="email" id="loginEmail" required>

    <label>Password</label>
    <input type="password" id="loginPassword" required>

    <button type="submit">Login</button>

    <div class="error" id="loginError"></div>

    <div class="toggle-link">No account? <a href="#" id="showSignup">Sign Up</a></div>
  </form>

  <!-- SIGNUP FORM -->
  <form id="signupForm" style="display:none;">
    <label>Full Name</label>
    <input type="text" id="signupName" required>

    <label>Email</label>
    <input type="email" id="signupEmail" required>

    <label>Phone Number</label>
    <input type="text" id="signupPhone" required>

    <label>Role</label>
    <select id="signupRole" required>
      <option value="">Select Role</option>
      <option value="Chairperson">Chairperson</option>
      <option value="Secretary">Secretary</option>
      <option value="Treasurer">Treasurer</option>
    </select>

    <label>Password</label>
    <input type="password" id="signupPassword" required>

    <button type="submit" id="signupBtn">Sign Up</button>

    <div class="error" id="signupError"></div>
    <div class="success" id="signupSuccess"></div>

    <div class="toggle-link">Have an account? <a href="#" id="showLogin">Login</a></div>
  </form>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDi-CrxIRZWNyrQLWgpLP-S20TlDwPKyd0",
  authDomain: "vyg-admin.firebaseapp.com",
  databaseURL: "https://vyg-admin-default-rtdb.firebaseio.com",
  projectId: "vyg-admin",
  storageBucket: "vyg-admin.firebasestorage.app",
  messagingSenderId: "130045074518",
  appId: "1:130045074518:web:0cea4a53d34194f89f2ff7",
  measurementId: "G-94M788XBYX"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();

// Toggle forms
showSignup.onclick = e => { e.preventDefault(); loginForm.style.display="none"; signupForm.style.display="block"; formTitle.innerText="Admin Sign Up"; };
showLogin.onclick = e => { e.preventDefault(); signupForm.style.display="none"; loginForm.style.display="block"; formTitle.innerText="Admin Login"; };

// Update role options based on existing admins
const signupRoleSelect = document.getElementById("signupRole");
const signupBtn = document.getElementById("signupBtn");

async function updateRoleOptions() {
  const snap = await db.ref("adminsList").get();
  const admins = snap.val() || {};
  const rolesTaken = Object.values(admins).map(a => a.role);

  Array.from(signupRoleSelect.options).forEach(opt => {
    if (rolesTaken.includes(opt.value)) opt.disabled = true;
    else opt.disabled = false;
  });

  const availableRoles = Array.from(signupRoleSelect.options).filter(opt => !opt.disabled && opt.value);
  signupBtn.disabled = availableRoles.length === 0;
}
updateRoleOptions();

// SIGNUP
signupForm.addEventListener("submit", async e => {
  e.preventDefault();
  signupError.textContent = "";
  signupSuccess.textContent = "";

  const name = signupName.value.trim();
  const email = signupEmail.value.trim();
  const phone = signupPhone.value.trim();
  const role = signupRole.value;
  const password = signupPassword.value;

  try {
    // Create Firebase Auth user
    const userCred = await auth.createUserWithEmailAndPassword(email, password);
    const uid = userCred.user.uid;

    // Save admin in RTDB
    await db.ref("adminsList/" + uid).set({ name, email, phone, role, createdAt: Date.now() });

    signupSuccess.textContent = "Signup successful! You may now login.";
    signupForm.reset();
    updateRoleOptions();

  } catch(err){
    signupError.textContent = err.message;
  }
});

// LOGIN — verify from adminsList
loginForm.addEventListener("submit", async e => {
  e.preventDefault();
  loginError.textContent = "";

  try {
    const userCred = await auth.signInWithEmailAndPassword(loginEmail.value.trim(), loginPassword.value);
    const uid = userCred.user.uid;

    const adminSnap = await db.ref("adminsList/" + uid).get();
    if (!adminSnap.exists()) {
      await auth.signOut();
      loginError.textContent = "Access Denied. You are NOT an admin.";
      return;
    }

    window.location.href = "admin-dashboard.html";

  } catch(err) {
    loginError.textContent = err.message;
  }
});
</script>
</body>
</html>
