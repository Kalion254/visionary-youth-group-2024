<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Dashboard - Visionary Youth Group</title>

<!-- Tailwind CSS & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body { font-family:'Poppins',sans-serif; background:#f0f2f5; }
  .card:hover { transform: scale(1.05); transition: 0.3s; }
  .tab-btn { cursor:pointer; transition:0.3s; }
  .tab-btn:hover { background:#ffcc00; color:#333; }
</style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header class="bg-blue-700 text-white p-4 flex justify-between items-center shadow-lg">
  <h1 class="text-2xl font-bold">Member Dashboard</h1>
  <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded flex items-center">
    <i class="fas fa-sign-out-alt mr-2"></i>Logout
  </button>
</header>

<main class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

  <!-- Profile Card -->
  <section class="bg-white shadow-lg rounded-lg p-6 card">
    <h2 class="text-xl font-bold mb-4 text-blue-600"><i class="fas fa-user"></i> Profile</h2>
    <input id="name" placeholder="Full Name" class="w-full border p-2 mb-2 rounded">
    <input id="email" placeholder="Email" class="w-full border p-2 mb-2 rounded">
    <input id="phone" placeholder="Phone" class="w-full border p-2 mb-2 rounded">
    <button onclick="updateProfile()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded mt-2 flex items-center justify-center">
      <i class="fas fa-edit mr-2"></i> Update Profile
    </button>
    <p id="profileMsg" class="mt-2 text-sm text-gray-600"></p>
  </section>

  <!-- Savings Card -->
  <section class="bg-white shadow-lg rounded-lg p-6 card">
    <h2 class="text-xl font-bold mb-4 text-purple-600"><i class="fas fa-piggy-bank"></i> Savings</h2>
    <input id="savingsAmount" placeholder="Amount to Save" class="w-full border p-2 mb-2 rounded">
    <button onclick="addSavings()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 rounded flex items-center justify-center">
      <i class="fas fa-plus mr-2"></i> Add Savings
    </button>
    <p id="savingsMsg" class="mt-2 text-sm text-gray-600"></p>
  </section>

  <!-- Shares Card -->
  <section class="bg-white shadow-lg rounded-lg p-6 card">
    <h2 class="text-xl font-bold mb-4 text-pink-600"><i class="fas fa-chart-pie"></i> Shares</h2>
    <input id="sharesAmount" placeholder="Number of Shares" class="w-full border p-2 mb-2 rounded">
    <button onclick="addShares()" class="w-full bg-pink-500 hover:bg-pink-600 text-white py-2 rounded flex items-center justify-center">
      <i class="fas fa-plus mr-2"></i> Add Shares
    </button>
    <p id="sharesMsg" class="mt-2 text-sm text-gray-600"></p>
  </section>

  <!-- Loan Section with Tabs -->
  <section class="bg-white shadow-lg rounded-lg p-6 col-span-full card">
    <h2 class="text-xl font-bold mb-4 text-yellow-600"><i class="fas fa-hand-holding-usd"></i> Loan Management</h2>
    
    <!-- Tabs -->
    <div class="flex mb-4 space-x-2">
      <button class="tab-btn bg-yellow-500 text-white px-4 py-2 rounded" onclick="showTab('apply')"><i class="fas fa-file-alt mr-1"></i> Apply Loan</button>
      <button class="tab-btn bg-yellow-500 text-white px-4 py-2 rounded" onclick="showTab('repay')"><i class="fas fa-hand-holding-heart mr-1"></i> Repay Loan</button>
      <button class="tab-btn bg-yellow-500 text-white px-4 py-2 rounded" onclick="showTab('download')"><i class="fas fa-download mr-1"></i> Download Certificate</button>
    </div>

    <!-- Tab Contents -->
    <div id="loanTabs">

      <!-- Apply Loan -->
      <div id="apply" class="tab-content">
        <input id="loanAmount" placeholder="Loan Amount" class="w-full border p-2 mb-2 rounded">
        <textarea id="loanPurpose" placeholder="Loan Purpose" class="w-full border p-2 mb-2 rounded"></textarea>
        <button onclick="applyLoan()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded flex items-center justify-center">
          <i class="fas fa-paper-plane mr-2"></i> Submit Application
        </button>
        <p id="loanMsg" class="mt-2 text-sm text-gray-600"></p>
      </div>

      <!-- Repay Loan -->
      <div id="repay" class="tab-content hidden">
        <input id="repaymentAmount" placeholder="Repayment Amount" class="w-full border p-2 mb-2 rounded">
        <button onclick="repayLoan()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded flex items-center justify-center">
          <i class="fas fa-hand-holding-usd mr-2"></i> Repay Loan
        </button>
        <p id="repayMsg" class="mt-2 text-sm text-gray-600"></p>
      </div>

      <!-- Download Loan Certificate -->
      <div id="download" class="tab-content hidden">
        <button onclick="downloadLoanCert()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded flex items-center justify-center">
          <i class="fas fa-file-download mr-2"></i> Download Loan Certificate
        </button>
        <p id="downloadMsg" class="mt-2 text-sm text-gray-600"></p>
      </div>

      <!-- Loan Status Bar -->
      <p class="mt-4 font-semibold">Loan Status: <span id="loanStatus">No application yet</span></p>
      <progress id="loanProgress" value="0" max="100" class="w-full mt-2"></progress>
    </div>
  </section>

</main>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA_OCu7HQ5HCH2OYx5dQ2Z1r7YPwQJave4",
    authDomain: "visionary-youth-grou-2024.firebaseapp.com",
    databaseURL: "https://visionary-youth-grou-2024-default-rtdb.firebaseio.com/",
    projectId: "visionary-youth-grou-2024",
    storageBucket: "visionary-youth-grou-2024.firebasestorage.app",
    messagingSenderId: "372978592717",
    appId: "1:372978592717:web:624596619d41aab84f3284",
    measurementId: "G-FEHC1GM3B7"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // Logout
  function logout(){ auth.signOut().then(()=>window.location.href="index.html"); }

  // Tabs
  function showTab(tab){
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));
    document.getElementById(tab).classList.remove('hidden');
  }

  // Load user profile
  auth.onAuthStateChanged(user=>{
    if(!user) window.location.href="index.html";
    else {
      db.ref("members/"+user.uid+"/profile").on("value",snap=>{
        if(snap.exists()){
          const data = snap.val();
          document.getElementById("name").value = data.name || '';
          document.getElementById("email").value = data.email || '';
          document.getElementById("phone").value = data.phone || '';
        }
      });
      db.ref("members/"+user.uid+"/loan").on("value",snap=>{
        if(snap.exists()){
          const loan = snap.val();
          document.getElementById("loanStatus").innerText = loan.status || "Pending";
          document.getElementById("loanProgress").value = loan.progress || 0;
        }
      });
    }
  });

  // Profile update
  function updateProfile(){
    const user = auth.currentUser;
    if(!user) return;
    const data = {
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value
    };
    db.ref("members/"+user.uid+"/profile").set(data).then(()=>{
      document.getElementById("profileMsg").innerText="Profile updated!";
    });
  }

  // Loan application
  function applyLoan(){
    const user = auth.currentUser;
    if(!user) return;
    const loanData = {
      amount: document.getElementById("loanAmount").value,
      purpose: document.getElementById("loanPurpose").value,
      status:"Pending",
      progress:20
    };
    db.ref("members/"+user.uid+"/loan").set(loanData).then(()=>{
      document.getElementById("loanMsg").innerText="Loan applied successfully!";
      document.getElementById("loanStatus").innerText="Pending";
      document.getElementById("loanProgress").value=20;
    });
  }

  // Loan repayment
  function repayLoan(){
    const user = auth.currentUser;
    if(!user) return;
    const repayment = document.getElementById("repaymentAmount").value;
    db.ref("members/"+user.uid+"/repayments").push({ amount:repayment, date:new Date().toLocaleDateString() })
      .then(()=>{ document.getElementById("repayMsg").innerText="Repayment recorded!"; });
  }

  // Add savings
  function addSavings(){
    const user = auth.currentUser;
    if(!user) return;
    const amount = document.getElementById("savingsAmount").value;
    db.ref("members/"+user.uid+"/savings").push({ amount, date:new Date().toLocaleDateString() })
      .then(()=>{ document.getElementById("savingsMsg").innerText="Savings added!"; });
  }

  // Add shares
  function addShares(){
    const user = auth.currentUser;
    if(!user) return;
    const shares = document.getElementById("sharesAmount").value;
    db.ref("members/"+user.uid+"/shares").push({ amount:shares, date:new Date().toLocaleDateString() })
      .then(()=>{ document.getElementById("sharesMsg").innerText="Shares recorded!"; });
  }

  // Download loan certificate
  function downloadLoanCert(){
    const user = auth.currentUser;
    if(!user) return;
    const loanStatus = document.getElementById("loanStatus").innerText;
    if(loanStatus !== "Approved") { 
      document.getElementById("downloadMsg").innerText="Loan not approved yet!";
      return; 
    }
    const blob = new Blob(["Loan Certificate\nMember: "+user.email+"\nStatus: Approved"], {type:"text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "LoanCertificate.txt";
    link.click();
    document.getElementById("downloadMsg").innerText="Certificate downloaded!";
  }
</script>

</body>
</html>
